import{_ as C,c as k}from"./client-only.92af7aea.js";import{u as E,o as I,F as R,G as H,H as L,j as S,k as T,_ as U,m as z,q as V}from"./entry.28691676.js";import{T as W,V as y,C as B,F as G,d as K,p as $,R as D,P as N,a as O,u as j,c as q,E as X,M as Y,f as P}from"./psrdnoise.6a9cb26e.js";import{l as Z}from"./assets.1e6d092a.js";class J extends W{constructor(t=64,e=1,n=8,r=4){const a=new Array(t+1).fill(0).map(()=>new y);a.forEach((s,p)=>{s.x=p/t-.5});const c=new B(a);super(c,t+r*2,e,n,!1),this.curve=c,this.parameters.capSegments=r;const l=[],g=this.attributes.position.count;for(let s=0;s<g;s++)l.push(0,0,0);this.setAttribute("color",new G(l,3))}update(){Q(this)}}function Q(h){const{curve:t}=h,{tubularSegments:e,radius:n,radialSegments:r,capSegments:a}=h.parameters,c=t.computeFrenetFrames(t.points.length,!1);h.tangents=c.tangents,h.normals=c.normals,h.binormals=c.binormals;const l=h.getAttribute("position"),g=h.getAttribute("normal"),s=new y,p=new y,_=new y;for(let d=0;d<=e;d++)w(d);l.needsUpdate=!0,g.needsUpdate=!0;function w(d){let o=n;const i=Math.min(t.points.length-1,Math.max(0,d-a)),m=i/(t.points.length-1);let u;if(d<a){t.getPointAt(0,p),t.getPointAt(.5*1/t.points.length,_),u=d/a*(Math.PI/2);const f=Math.cos(Math.PI+u)*n,x=Math.sin(u)*n;p.add(_.sub(p).normalize().multiplyScalar(f)),o=x}else if(d>e-a){t.getPointAt(1,p),t.getPointAt(1-.5*1/t.points.length,_),u=(d-t.points.length+1)/a*(Math.PI/2);const f=Math.cos(u)*n,x=Math.sin(u)*n;p.add(_.sub(p).normalize().multiplyScalar(f)),o=x}else _.set(0,0,0),t.getPointAt(m,p);let v=d*(r+1);const F=c.normals[i],M=c.binormals[i];for(let f=0;f<=r;f++){const x=f/r*Math.PI*2,b=Math.sin(x),A=-Math.cos(x);s.x=A*F.x+b*M.x,s.y=A*F.y+b*M.y,s.z=A*F.z+b*M.z,s.normalize(),l.setXYZ(v,p.x+o*s.x,p.y+o*s.y,p.z+o*s.z),u!==void 0&&s.applyAxisAngle(M.clone().cross(F).cross(s),-Math.PI/2+u),g.setXYZ(v,s.x,s.y,s.z),v++}}}class ee extends K{constructor(t,e){const n=t.tubularSegments||64,r=t.radius||.5,a=t.radialSegments||8,c=t.capSegments||4,l=new J(n,r,a,c);super(l,e),this.curve=this.geometry.curve,this.points=this.curve.points,this.to=new y,this.geometry.update()}lerpTo(t,e=.1,n){const r=new Float32Array(3),a=new Float32Array(3),c=new Float32Array(3);c[0]=t.x*.01+n*.04,c[1]=t.y*.01+n*.048,c[2]=t.z*.01+n*.06,$(c,r,n*2,a),this.to.copy(t),this.to.x+=a[0]*.05,this.to.y+=a[1]*.05,this.to.z+=a[2]*.05,this.points[0].lerp(this.to,e);for(let l=1;l<this.points.length;l++){const g=l/(this.points.length-1)-e/(this.points.length-1);this.curve.getPointAt(g,this.points[l])}this.geometry.update()}}const te={id:"webgl-main"},ne={__name:"Tubes3.client",setup(h){const t=E().$device;let e,n;const r=new Array(32),a=new y,c=new D,l=new N(new y(0,0,1),0),g=new O,s={pause:!1,pointerHover:!1};I(()=>{R(async()=>{e=j({id:"webgl-main",antialias:!0,alpha:!0}),e.minPixelRatio=2,e.maxPixelRatio=2,e.cameraMaxAspect=1.7,e.resize(),e.camera.position.set(0,0,5),e.camera.lookAt(0,0,0),e.updateWorldSize(),n=q(e.camera,e.canvas),n.addEventListener("change",()=>{e.updateWorldSize()});const o=await Z("/envmaps/studio_small_08_1k.hdr");o.mapping=X,e.scene.background=o;for(let i=0;i<r.length;i++){const m=P.randFloat(.005,.05),u=P.randInt(64,256),v=new Y({color:Math.random()*16777215,metalness:1,roughness:0,envMap:o});r[i]=new ee({radius:m,tubularSegments:u,capSements:6},v),r[i].timeDelta=Math.random()*100,e.scene.add(r[i])}document.addEventListener("pointermove",_),e.on("update",p)}),H().on("device.resize",()=>{e&&e.resize()}),document.addEventListener("keydown",w)});function p(o){var i;if(n.update(),!t.pointer.hover){const m=o.elapsed;a.x=Math.cos(m*2.5)*e.size.wHeight*.25,a.y=Math.sin(m*1.6)*e.size.wHeight*.25,a.z=0}if(!s.pause)for(let m=0;m<r.length;m++){const u=r[m];u.lerpTo(a,.35,o.elapsed+u.timeDelta),(i=u.helper)==null||i.update()}}function _(o){s.pointerHover=!0,g.copy(t.pointer.relative),c.setFromCamera(g,e.camera),e.camera.getWorldDirection(l.normal),c.ray.intersectPlane(l,a)}function w(o){o.code==="Space"?s.pause=!s.pause:o.code==="KeyL"||(o.code==="KeyT"||o.code==="KeyC")&&d()}function d(){const o=[];for(let i=0;i<r.length;i++){const m=Math.random()*16777215;o.push(m),r[i].material.color.set(m)}console.log("randomTubesColors",o.map(i=>"#"+(i&16777215).toString(16).padStart(6,"0")))}return L(()=>{document.removeEventListener("pointermove",_),document.removeEventListener("keydown",w),n==null||n.dispose(),e&&(e.off("update",p),e.scene.clear(),e.dispose())}),(o,i)=>(S(),T("canvas",te))}},se=ne,oe=k(se),ae={},re={class:"test"};function ie(h,t){const e=oe,n=C;return S(),T("div",re,[z(n,null,{default:V(()=>[z(e)]),_:1})])}const de=U(ae,[["render",ie]]);export{de as default};
